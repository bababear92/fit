<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’ª çŒ›ç”·ç‡Ÿé¤Šè¿½è¹¤</title>
    <style>
        /* å…¨è¢å¹•èƒŒæ™¯åœ–è¨­å®š */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: #000; /* å‚™ç”¨èƒŒæ™¯è‰² */
            position: relative;
        }

        /* èƒŒæ™¯åœ–ç‰‡å±¤ï¼šæ§åˆ¶é€æ˜åº¦ */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://images.unsplash.com/photo-1583454110551-21f2fa20019b?q=80&w=2070&auto=format&fit=crop'); 
            background-size: cover;
            background-position: center;
            opacity: 0.3; /* é€™è£¡èª¿æ•´åœ–ç‰‡é€æ˜åº¦ï¼Œ0.1 æ›´æš—ï¼Œ0.9 æ›´äº® */
            z-index: -1;
        }

        /* ä¸»å¡ç‰‡ï¼šæ·±è‰²åŠé€æ˜ */
        .card {
            background: rgba(30, 30, 45, 0.85); /* åŠé€æ˜æ·±è‰²åº• */
            backdrop-filter: blur(10px); /* ç£¨ç ‚ç»ç’ƒæ•ˆæœ */
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        h2 {
            text-align: center;
            color: #00e5ff;
            margin-top: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* ç›®æ¨™è¨­å®šå€ */
        .goal-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stat-label {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 900;
        }

        /* æ•¸å€¼é¡¯ç¤º */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        #remainingCal { color: #50fa7b; }
        #totalProDisplay { color: #8be9fd; }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #444;
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            font-size: 16px;
            box-sizing: border-box;
        }

        input:focus {
            outline: none;
            border-color: #00e5ff;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }

        .btn-add {
            background: linear-gradient(45deg, #00c853, #b2ff59);
            color: #000;
        }

        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 200, 83, 0.4); }

        .btn-reset {
            background: transparent;
            color: #ff5252;
            text-decoration: underline;
            font-size: 13px;
            margin-top: 20px;
        }

        /* è­¦å‘Šé¡è‰² */
        .over-limit { color: #ff5252 !important; }
    </style>
</head>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<div id="ai-food-tracker" style="background:#2c2c2c; color:white; padding:20px; border-radius:12px; margin:20px 0; font-family: sans-serif;">
    <h3 style="margin-top:0;">ğŸ² AI ç‡Ÿé¤Šè‡ªå‹•è¾¨è­˜</h3>
    <input type="file" id="food-input" accept="image/*" capture="camera" style="display:none;">
    <button onclick="document.getElementById('food-input').click()" style="background:#4CAF50; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; width:100%;">
        ğŸ“· æ‹æ”æ¨™ç±¤æˆ–é£Ÿç‰©
    </button>
    <p id="status" style="font-size:12px; color:#aaa; margin:10px 0;">ç­‰å¾…æ“ä½œ...</p>
    <div style="display:flex; justify-content:space-between; background:#1a1a1a; padding:10px; border-radius:8px;">
        <span>ğŸ”¥ å‰©é¤˜ç†±é‡: <b id="cal-left">2000</b> kcal</span>
        <span>ğŸ¥© è›‹ç™½è³ª: <b id="pro-total">0</b> g</span>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
// --- é‡è¦ï¼šè«‹å°‡ä¸‹æ–¹çš„ 'ä½ çš„é‡‘é‘°' æ›¿æ›æˆä½ æˆªåœ–ä¸­é‚£ä¸€ä¸²è—è‰²çš„ä»£ç¢¼ ---
const MY_GEMINI_KEY = 'AIzaSyCV4UqHOr0fVu5RUBvZvrpZxhzXeBljmHY'; 

document.getElementById('food-input').onchange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const status = document.getElementById('status');
    status.innerText = "â³ æ­£åœ¨åˆ†æåœ–ç‰‡ï¼Œè«‹ç¨å€™...";
    status.style.color = "#ffcc00"; // é¡¯ç¤ºç‚ºé»ƒè‰²æé†’æ­£åœ¨è™•ç†

    try {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
            const base64Data = reader.result.split(',')[1];
            
            // å‘¼å« Google Gemini API
            // å°‡åŸæœ¬çš„ v1beta æ”¹æˆ v1
const apiUrl = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${MY_GEMINI_KEY}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { text: "è«‹è¾¨è­˜åœ–ä¸­é£Ÿç‰©æˆ–ç‡Ÿé¤Šæ¨™ç±¤ï¼Œä¼°ç®—ç†±é‡(kcal)èˆ‡è›‹ç™½è³ª(g)ã€‚å¿…é ˆåš´æ ¼å›å‚³ç´”JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«æ¨™è¨˜æ–‡å­—ï¼š{\"cal\": æ•¸å­—, \"pro\": æ•¸å­—, \"name\": \"é£Ÿç‰©åç¨±\"}" },
                            { inline_data: { mime_type: "image/jpeg", data: base64Data } }
                        ]
                    }]
                })
            });

            const data = await response.json();

            // éŒ¯èª¤æ•æ‰é‚è¼¯
            if (data.error) {
                throw new Error(`API éŒ¯èª¤: ${data.error.message}`);
            }

            const rawText = data.candidates[0].content.parts[0].text;
            const result = JSON.parse(rawText.replace(/```json|```/g, '').trim());

            // æ›´æ–°ç¶²é ä¸Šçš„æ•¸å€¼
            const calEl = document.getElementById('cal-left');
            const proEl = document.getElementById('pro-total');

            // åŸ·è¡Œæ‰£é™¤èˆ‡å¢åŠ é‚è¼¯
            const currentCal = parseInt(calEl.innerText) || 2000;
            const currentPro = parseFloat(proEl.innerText) || 0;

            calEl.innerText = currentCal - result.cal;
            proEl.innerText = (currentPro + result.pro).toFixed(1);

            status.innerText = `âœ… è¾¨è­˜å®Œæˆï¼š${result.name}`;
            status.style.color = "#4CAF50";
            alert(`æˆåŠŸç´€éŒ„ ${result.name}ï¼\nğŸ”¥ ç†±é‡ï¼š-${result.cal} kcal\nğŸ¥© è›‹ç™½è³ªï¼š+${result.pro} g`);
        };
    } catch (err) {
        console.error(err);
        status.innerText = `âŒ å‡ºéŒ¯äº†ï¼š${err.message}`;
        status.style.color = "#ff4444";
    }
};
</script>
<body>

<div class="card">
    <h2>Fitness Tracker</h2>

    <div class="goal-section">
        <div class="stat-label">ğŸ¯ ä»Šæ—¥ç›®æ¨™ç†±é‡</div>
        <input type="number" id="goalInput" onchange="updateGoal()" placeholder="è¨­å®šç›®æ¨™">
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">å‰©é¤˜ç†±é‡</div>
            <div id="remainingCal" class="stat-value">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">ç¸½è›‹ç™½è³ª</div>
            <div id="totalProDisplay" class="stat-value">0g</div>
        </div>
    </div>

    <div style="border-top: 1px solid #444; padding-top: 15px;">
        <div class="stat-label">ğŸ´ æ–°å¢æ”å– (kcal)</div>
        <input type="number" id="addCal" placeholder="ç†±é‡">
        <div class="stat-label">ğŸ¥© æ–°å¢è›‹ç™½è³ª (g)</div>
        <input type="number" id="addPro" placeholder="è›‹ç™½è³ª">
        <button class="btn-add" onclick="addEntry()">åŠ å…¥ä»Šæ—¥é€²åº¦</button>
    </div>
    
    <button class="btn-reset" onclick="resetData()">é‡ç½®æ•¸æ“š</button>
</div>

<script>
    let calorieGoal = 2000;
    let consumedCal = 0;
    let totalPro = 0;

    window.onload = function() {
        calorieGoal = parseInt(localStorage.getItem('calorieGoal')) || 2000;
        consumedCal = parseInt(localStorage.getItem('consumedCal')) || 0;
        totalPro = parseInt(localStorage.getItem('totalPro')) || 0;
        
        document.getElementById('goalInput').value = calorieGoal;
        refreshUI();
    };

    function updateGoal() {
        calorieGoal = parseInt(document.getElementById('goalInput').value) || 0;
        localStorage.setItem('calorieGoal', calorieGoal);
        refreshUI();
    }

    function addEntry() {
        consumedCal += parseInt(document.getElementById('addCal').value) || 0;
        totalPro += parseInt(document.getElementById('addPro').value) || 0;
        
        document.getElementById('addCal').value = '';
        document.getElementById('addPro').value = '';
        
        save();
    }

    function save() {
        localStorage.setItem('consumedCal', consumedCal);
        localStorage.setItem('totalPro', totalPro);
        refreshUI();
    }

    function refreshUI() {
        const remaining = calorieGoal - consumedCal;
        const remDisplay = document.getElementById('remainingCal');
        remDisplay.innerText = remaining;
        document.getElementById('totalProDisplay').innerText = totalPro + "g";
        
        if (remaining < 0) {
            remDisplay.classList.add('over-limit');
        } else {
            remDisplay.classList.remove('over-limit');
        }
    }

    function resetData() {
        if (confirm("ç¢ºå®šè¦æ¸…ç©ºä»Šå¤©çš„è¨˜éŒ„å—ï¼Ÿ")) {
            consumedCal = 0;
            totalPro = 0;
            save();
        }
    }
</script>

</body>
</html>




